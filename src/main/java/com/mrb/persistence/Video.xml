<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="video">
	<insert id="addVideo" parameterClass="com.mrb.bean.VideoBean">
		insert into tbvideo
		values(#vid#,#vcid#,#status#,#description#,#tags#,#snapshot_url#,#thumbnail_url#,#file_size#,#activated#,#modified_time#,#created_time#,#height#,#width#,#duration#,#extension#,#title#,#mp4_url#,#mp4_expires#,#permanent_url#,#permanent_expires#,#m3u8_url#,#m3u8_expires#,#zm_file_size#,#zm_type#,#zm_id#,#type#,#teacher#,#date#,#opdate#,#operid#)
	</insert>

	<select id="getVideoById" parameterClass="java.lang.String"
		resultClass="com.mrb.bean.VideoBean">
		select * from tbvideo where vid = #id#
	</select>

	<select id="getVideoList" parameterClass="java.util.HashMap"
		resultClass="com.mrb.bean.VideoBean">
		select * from tbvideo order by date desc limit #index#,
		#cnt#
	</select>

	<!-- for phone -->
	<select id="getVList" parameterClass="java.util.HashMap"
		resultClass="com.mrb.pbean.VBean">
		select v.vid, v.vcid, v.title, v.duration, v.type,
		v.teacher,
		v.description, v.date, if(isnull(vr.cnt),0,vr.cnt) as
		reviewcnt from tbvideo v
		left join vvreview vr on v.vid = vr.vid where
		v.vcid = #vcid#
		order by v.date desc limit #index#,
		#cnt#
	</select>

	<select id="getVDetail" parameterClass="com.mrb.pbean.VDetailReqBean"
		resultClass="com.mrb.pbean.VDetailRespBean">
		select v.mp4_url as vuri, v.title, v.duration, v.type,
		v.teacher,
		v.description, v.date, if(isnull(vp.cnt), 0 , vp.cnt) as
		playcnt from
		tbvideo v
		left outer join vvplay vp on v.vid =
		vp.vid
		where
		v.vid = #vid# order by
		v.date desc
	</select>

	<select id="getVideoCnt" resultClass="java.lang.Integer">
		select count(1) from
		tbvideo
	</select>

	<update id="updateVideo" parameterClass="com.mrb.bean.VideoBean">
		update tbvideo set opdate=#opdate#
		<isNotEmpty prepend="," property="vcid">vcid=#vcid#</isNotEmpty>
		<isNotEmpty prepend="," property="status">status=#status#</isNotEmpty>
		<isNotEmpty prepend="," property="description">description=#description#</isNotEmpty>
		<isNotEmpty prepend="," property="tags">tags=#tags#</isNotEmpty>
		<isNotEmpty prepend="," property="snapshot_url">snapshot_url=#snapshot_url#</isNotEmpty>
		<isNotEmpty prepend="," property="thumbnail_url">thumbnail_url=#thumbnail_url#</isNotEmpty>
		<isNotEmpty prepend="," property="file_size">file_size=#file_size#</isNotEmpty>
		<isNotEmpty prepend="," property="activated">activated=#activated#</isNotEmpty>
		<isNotEmpty prepend="," property="modified_time">modified_time=#modified_time#</isNotEmpty>
		<isNotEmpty prepend="," property="created_time">created_time=#created_time#</isNotEmpty>
		<isNotEmpty prepend="," property="height">height=#height#</isNotEmpty>
		<isNotEmpty prepend="," property="width">width=#width#</isNotEmpty>
		<isNotEmpty prepend="," property="duration">duration=#duration#</isNotEmpty>
		<isNotEmpty prepend="," property="extension">extension=#extension#</isNotEmpty>
		<isNotEmpty prepend="," property="title">title=#title#</isNotEmpty>
		<isNotEmpty prepend="," property="mp4_url">mp4_url=#mp4_url#</isNotEmpty>
		<isNotEmpty prepend="," property="mp4_expires">mp4_expires=#mp4_expires#</isNotEmpty>
		<isNotEmpty prepend="," property="permanent_url">permanent_url=#permanent_url#</isNotEmpty>
		<isNotEmpty prepend="," property="permanent_expires">permanent_expires=#permanent_expires#</isNotEmpty>
		<isNotEmpty prepend="," property="m3u8_url">m3u8_url=#m3u8_url#</isNotEmpty>
		<isNotEmpty prepend="," property="m3u8_expires">m3u8_expires=#m3u8_expires#</isNotEmpty>
		<isNotEmpty prepend="," property="zm_file_size">zm_file_size=#zm_file_size#</isNotEmpty>
		<isNotEmpty prepend="," property="zm_type">zm_type=#zm_type#</isNotEmpty>
		<isNotEmpty prepend="," property="zm_id">zm_id=#zm_id#</isNotEmpty>
		<isNotEmpty prepend="," property="date">date=#date#</isNotEmpty>
		<isNotEmpty prepend="," property="opdate">opdate=#opdate#</isNotEmpty>
		<isNotEmpty prepend="," property="operid">operid=#operid#</isNotEmpty>
		where vid=#vid#
	</update>

	<delete id="delVideoById" parameterClass="java.lang.String">
		delete from tbvideo
		where vid = #id#
	</delete>
</sqlMap>